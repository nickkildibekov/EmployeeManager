<div class="container">
  <div class="header-section">
    <button class="back-button" (click)="goBack()">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</button>
  </div>

  @if (isFetching()) {
  <div class="loading">
    <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π –≤—ñ–¥–¥—ñ–ª—É...</p>
  </div>
  } @else if (department()) {
  <div class="content">
    <div class="department-header">
      <div class="department-name-section">
        @if (isEditMode()) {
        <input
          type="text"
          [(ngModel)]="editedDepartment().name"
          class="department-name-input"
          [disabled]="isSaving()"
        />
        <div class="edit-actions">
          <button
            class="icon-button btn-success"
            (click)="saveDepartment()"
            [disabled]="isSaving() || !editedDepartment().name.trim()"
            title="–ó–±–µ—Ä–µ–≥—Ç–∏"
          >
            @if (isSaving()) { ‚è≥ } @else { ‚úì }
          </button>
          <button
            class="icon-button btn-secondary"
            (click)="toggleEditMode()"
            [disabled]="isSaving()"
            title="–°–∫–∞—Å—É–≤–∞—Ç–∏"
          >
            ‚úï
          </button>
        </div>
        } @else {
        <h1 class="department-name">{{ department()?.name }}</h1>
        <div class="department-actions">
          <button
            class="icon-button btn-primary"
            (click)="toggleEditMode()"
            [disabled]="isSaving() || isDeleting()"
            title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤—ñ–¥–¥—ñ–ª"
          >
            ‚úèÔ∏è
          </button>
          <button
            class="icon-button btn-danger"
            (click)="deleteDepartment()"
            [disabled]="isSaving() || isDeleting()"
            title="–í–∏–¥–∞–ª–∏—Ç–∏ –≤—ñ–¥–¥—ñ–ª"
          >
            üóëÔ∏è
          </button>
        </div>
        }
      </div>
    </div>

    <div class="sections-container">
      <!-- Positions Section -->
      <div class="info-section">
        <h3>–ü–æ—Å–∞–¥–∏</h3>
        <div class="info-list">
          @if (positionsList().length > 0) { @for (pos of positionsList(); track pos.id) {
          <div
            class="info-item"
            [class.filtered]="selectedPositionId() === pos.id"
            (click)="togglePositionFilter(pos.id, $event)"
            style="cursor: pointer"
          >
            <span class="info-label">{{ pos.name }}</span>
            <span class="info-value">{{ pos.count }} {{ getEmployeeCountText(pos.count) }}</span>
            @if (selectedPositionId() === pos.id) {
            <span class="filter-indicator" title="–§—ñ–ª—å—Ç—Ä –∞–∫—Ç–∏–≤–Ω–∏–π">üîç</span>
            }
          </div>
          } } @else {
          <p class="no-data">–ü–æ—Å–∞–¥ –Ω–µ–º–∞—î</p>
          }
        </div>
      </div>

      <!-- Employees Section -->
      <div class="info-section">
        <div class="section-header-with-filter">
          <h3>–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏</h3>
          @if (selectedPositionId() !== null) {
          <button
            class="clear-filter-button"
            (click)="selectedPositionId.set(null)"
            title="–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä"
          >
            –û—á–∏—Å—Ç–∏—Ç–∏ ‚úï
          </button>
          }
        </div>
        <div class="info-list">
          @if (employeesList().length > 0) { @for (emp of employeesList(); track emp.id) {
          <div class="info-item" (click)="navigateToEmployee(emp.id)" style="cursor: pointer">
            <span class="info-label">{{ emp.fullName }}</span>
            <span class="info-value">{{ emp.position }}</span>
          </div>
          } } @else {
          <p class="no-data">
            @if (selectedPositionId() !== null) { –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –Ω–∞ –≤–∏–±—Ä–∞–Ω—ñ–π –ø–æ—Å–∞–¥—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ } @else {
            –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –Ω–µ–º–∞—î }
          </p>
          }
        </div>
      </div>

      <!-- Equipment Section -->
      <div class="info-section">
        <h3>–û–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h3>
        <div class="info-list">
          @if (equipmentList().length > 0) { @for (eq of equipmentList(); track eq.id) {
          <div class="info-item" (click)="navigateToEquipment(eq.id)" style="cursor: pointer">
            <span class="info-label">{{ eq.name }}</span>
            <span class="info-value"> {{ eq.count }} {{ getEquipmentCountText(eq.count) }} - {{ eq.statusText }} </span>
          </div>
          } } @else {
          <p class="no-data">–û–±–ª–∞–¥–Ω–∞–Ω–Ω—è –Ω–µ–º–∞—î</p>
          }
        </div>
      </div>
    </div>
  </div>
  } @else {
  <div class="loading">
    <p style="color: #e53e3e; font-weight: 600">
      ‚ö†Ô∏è –í—ñ–¥–¥—ñ–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞: {{ error() }}
    </p>
  </div>
  }
</div>
