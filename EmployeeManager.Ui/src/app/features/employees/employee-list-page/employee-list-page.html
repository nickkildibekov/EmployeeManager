<div class="container">
  <div class="header">
    <h2>–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏</h2>
    <button class="btn btn-primary" (click)="openAddModal()">
      + –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞
    </button>
  </div>

  <div *ngIf="error()" class="alert alert-danger">
    {{ error() }}
  </div>

  <!-- Filters -->
  <div class="filters">
    <select class="filter-select" (change)="onDepartmentChange($event.target.value)">
      <option value="">–í—Å—ñ –≤—ñ–¥–¥—ñ–ª–∏</option>
      <option *ngFor="let dept of departments()" [value]="dept.id">
        {{ dept.name }}
      </option>
    </select>
    <select class="filter-select" (change)="onPositionChange($event.target.value)">
      <option value="">–í—Å—ñ –ø–æ—Å–∞–¥–∏</option>
      <option *ngFor="let pos of positions()" [value]="pos.id">
        {{ pos.title }}
      </option>
    </select>
    <input
      type="text"
      class="filter-search"
      placeholder="–ü–æ—à—É–∫ –∑–∞ —ñ–º'—è–º..."
      (keyup)="onSearch($event.target.value)"
    />
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

  <!-- Table -->
  <div *ngIf="!isLoading()" class="table-container">
    <div *ngIf="employees().length === 0" class="empty-message">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</div>

    <table *ngIf="employees().length > 0" class="employees-table">
      <thead>
        <tr>
          <th class="sortable" (click)="toggleSort('callSign')">
            –ü–æ–∑–∏–≤–Ω–∏–π
            <span class="sort-indicator" *ngIf="sortBy() === 'callSign'">
              {{ sortOrder() === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('firstName')">
            –Ü–º'—è
            <span class="sort-indicator" *ngIf="sortBy() === 'firstName'">
              {{ sortOrder() === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('lastName')">
            –ü—Ä—ñ–∑–≤–∏—â–µ
            <span class="sort-indicator" *ngIf="sortBy() === 'lastName'">
              {{ sortOrder() === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('phoneNumber')">
            –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É
            <span class="sort-indicator" *ngIf="sortBy() === 'phoneNumber'">
              {{ sortOrder() === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('department')">
            –í—ñ–¥–¥—ñ–ª
            <span class="sort-indicator" *ngIf="sortBy() === 'department'">
              {{ sortOrder() === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('position')">
            –ü–æ—Å–∞–¥–∞
            <span class="sort-indicator" *ngIf="sortBy() === 'position'">
              {{ sortOrder() === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th>–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let emp of employees()" class="table-row">
          <td (click)="openEmployee(emp.id)" style="cursor: pointer">{{ emp.callSign || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ' }}</td>
          <td (click)="openEmployee(emp.id)" style="cursor: pointer">{{ emp.firstName || '-' }}</td>
          <td (click)="openEmployee(emp.id)" style="cursor: pointer">{{ emp.lastName || '-' }}</td>
          <td (click)="openEmployee(emp.id)" style="cursor: pointer">{{ emp.phoneNumber }}</td>
          <td (click)="openEmployee(emp.id)" style="cursor: pointer">{{ getDepartmentDisplayName(emp.departmentName) }}</td>
          <td (click)="openEmployee(emp.id)" style="cursor: pointer">{{ getPositionDisplayName(emp.positionName) }}</td>
          <td class="actions-cell" (click)="$event.stopPropagation()">
            <button class="btn-icon btn-edit" (click)="openEditModal(emp)" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">
              ‚úèÔ∏è
            </button>
            <button class="btn-icon btn-delete" (click)="confirmDelete(emp)" title="–í–∏–¥–∞–ª–∏—Ç–∏">
              üóëÔ∏è
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="employees().length > 0" class="pagination">
    <button class="btn btn-sm" (click)="changePage(page() - 1)" [disabled]="page() === 1">
      ‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—è
    </button>
    <span class="page-info">
      –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page() }} –∑ {{ Math.ceil(total() / pageSize()) }} (–í—Å—å–æ–≥–æ: {{ total() }})
    </span>
    <button
      class="btn btn-sm"
      (click)="changePage(page() + 1)"
      [disabled]="page() >= Math.ceil(total() / pageSize())"
    >
      –ù–∞—Å—Ç—É–ø–Ω–∞ ‚Üí
    </button>
  </div>

  <!-- Employee Modal -->
  <app-employee-modal
    [isOpen]="isModalOpen"
    [employee]="selectedEmployee()"
    [departments]="departments()"
    [positions]="positions()"
    [specializations]="specializations()"
    [formPositions]="formPositions()"
    (save)="onEmployeeSave($event)"
    (close)="closeModal()"
    (departmentChange)="onModalDepartmentChange($event)"
  />

  <!-- Confirmation Dialog -->
  @if (dialogService.isOpen()) {
  <app-confirmation-dialog
    [title]="dialogService.config()?.title || '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –¥—ñ—é'"
    [message]="dialogService.config()?.message || ''"
    [confirmText]="dialogService.config()?.confirmText || '–û–ö'"
    [cancelText]="dialogService.config()?.cancelText || '–°–∫–∞—Å—É–≤–∞—Ç–∏'"
    [variant]="dialogService.config()?.variant || 'warning'"
    (confirm)="dialogService.handleConfirm()"
    (cancel)="dialogService.handleCancel()"
  />
  }
</div>
