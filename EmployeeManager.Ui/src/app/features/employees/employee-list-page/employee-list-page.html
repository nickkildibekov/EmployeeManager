<div class="container">
  <div class="header">
    <h2>Employees</h2>
    <button class="btn btn-primary" (click)="toggleAddForm()">
      {{ isAddFormVisible() ? 'Cancel' : '+ Add Employee' }}
    </button>
  </div>

  <div *ngIf="error()" class="alert alert-danger">
    {{ error() }}
  </div>

  <!-- Add Form -->
  <div *ngIf="isAddFormVisible()" class="add-form">
    <div class="form-row">
      <input
        class="form-control"
        placeholder="First Name"
        [(ngModel)]="newEmployee().firstName"
      />
      <input
        class="form-control"
        placeholder="Last Name"
        [(ngModel)]="newEmployee().lastName"
      />
    </div>
    <div class="form-row">
      <input
        class="form-control"
        placeholder="Phone Number"
        [(ngModel)]="newEmployee().phoneNumber"
      />
      <select
        class="form-control"
        [(ngModel)]="newEmployee().positionId"
      >
        <option [value]="null">Select Position</option>
        <option *ngFor="let pos of positions()" [value]="pos.id">
          {{ pos.title }}
        </option>
      </select>
    </div>
    <div class="form-row">
      <select
        class="form-control"
        [(ngModel)]="newEmployee().departmentId"
      >
        <option [value]="null">Select Department</option>
        <option *ngFor="let dep of departments()" [value]="dep.id">
          {{ dep.name }}
        </option>
      </select>
    </div>
    <div class="button-row">
      <button
        class="btn btn-success"
        (click)="addEmployee()"
        [disabled]="!isFormValid()"
      >
        Add
      </button>
      <button class="btn btn-secondary" (click)="cancelAdd()">Cancel</button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <select
      class="filter-select"
      (change)="onDepartmentChange($event.target.value)"
    >
      <option value="">All Departments</option>
      <option *ngFor="let dept of departments()" [value]="dept.id">
        {{ dept.name }}
      </option>
    </select>
    <input
      type="text"
      class="filter-search"
      placeholder="Search by name..."
      (keyup)="onSearch($event.target.value)"
    />
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading">Loading...</div>

  <!-- List -->
  <div *ngIf="!isLoading()" class="list-container">
    <div
      *ngIf="employees().length === 0"
      class="empty-message"
    >
      No employees found.
    </div>

    <div *ngFor="let emp of employees()" class="list-item" (click)="openEmployee(emp.id)">
      <div class="item-content">
        @if (selectedDepartmentId() === null) {
          <h4>{{ emp.firstName }} {{ emp.lastName }} - {{ emp.departmentName }} - {{ emp.positionName || 'N/A' }}</h4>
        } @else {
          <h4>{{ emp.firstName }} {{ emp.lastName }} - {{ emp.positionName || 'N/A' }}</h4>
        }
      </div>
      <button
        class="btn btn-danger btn-sm"
        (click)="deleteEmployee(emp.id); $event.stopPropagation()"
      >
        Delete
      </button>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="employees().length > 0" class="pagination">
    <button
      class="btn btn-sm"
      (click)="changePage(page() - 1)"
      [disabled]="page() === 1"
    >
      ← Previous
    </button>
    <span class="page-info">
      Page {{ page() }} of {{ Math.ceil(total() / pageSize()) }} (Total: {{ total() }})
    </span>
    <button
      class="btn btn-sm"
      (click)="changePage(page() + 1)"
      [disabled]="page() >= Math.ceil(total() / pageSize())"
    >
      Next →
    </button>
  </div>
</div>
