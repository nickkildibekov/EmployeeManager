@if (isOpen()) {
<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="stopPropagation($event)">
    <div class="modal-header">
      <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h2>
      <button class="modal-close" (click)="onClose()" type="button">√ó</button>
    </div>

    <div class="modal-body">
      @if (displayedCategories().length === 0) {
      <p class="empty-message">–ù–µ–º–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</p>
      } @else {
      <div class="categories-list">
        @for (category of displayedCategories(); track category.id) {
        <div class="category-item">
          @if (editingCategoryId() === category.id) {
          <!-- Edit mode -->
          <div class="category-edit-form">
            <div class="form-group">
              <label>–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó <span class="required">*</span></label>
              <input
                type="text"
                class="form-input"
                [(ngModel)]="editedCategoryName"
                placeholder="–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó"
              />
            </div>
            <div class="form-group">
              <label>–û–ø–∏—Å</label>
              <input
                type="text"
                class="form-input"
                [(ngModel)]="editedCategoryDescription"
                placeholder="–û–ø–∏—Å (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)"
              />
            </div>
            <div class="category-actions">
              <button class="btn btn-success btn-sm" (click)="saveEdit(category.id)" type="button">
                üíæ –ó–±–µ—Ä–µ–≥—Ç–∏
              </button>
              <button class="btn btn-secondary btn-sm" (click)="cancelEdit()" type="button">
                ‚úï –°–∫–∞—Å—É–≤–∞—Ç–∏
              </button>
            </div>
          </div>
          } @else {
          <!-- View mode -->
          <div class="category-info">
            <div class="category-name">{{ category.name }}</div>
            @if (category.description) {
            <div class="category-description">{{ category.description }}</div>
            }
          </div>
          <div class="category-actions">
            <button
              class="btn btn-primary btn-sm"
              (click)="startEdit(category)"
              type="button"
              title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é"
            >
              ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
            </button>
            <button
              class="btn btn-danger btn-sm"
              (click)="onDelete(category.id)"
              type="button"
              title="–í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é"
            >
              üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
            </button>
          </div>
          }
        </div>
        }
      </div>
      }
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()" type="button">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
  </div>
</div>
}
