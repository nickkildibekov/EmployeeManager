<div class="container">
  <div class="header">
    <h2>Employees</h2>
    <button class="btn btn-primary" (click)="toggleAddForm()">
      {{ isAddFormVisible() ? 'Cancel' : '+ Add Employee' }}
    </button>
  </div>

  <div *ngIf="error()" class="alert alert-danger">
    {{ error() }}
  </div>

  <!-- Add Form -->
  <div *ngIf="isAddFormVisible()" class="add-form">
    <div class="form-row">
      <input class="form-control" placeholder="First Name" [(ngModel)]="newEmployee().firstName" />
      <input class="form-control" placeholder="Last Name" [(ngModel)]="newEmployee().lastName" />
    </div>
    <div class="form-row">
      <input
        class="form-control"
        placeholder="Phone Number"
        [(ngModel)]="newEmployee().phoneNumber"
      />
    </div>
    <div class="form-row">
      <select
        class="form-control"
        (change)="onNewDepartmentChange($event.target.value)"
        [ngModel]="newEmployee().departmentId"
      >
        <option [ngValue]="null" disabled>Select Department</option>
        <option *ngFor="let dep of departments()" [value]="dep.id">
          {{ dep.name }}
        </option>
      </select>
    </div>
    <div class="form-row">
      <select
        class="form-control"
        [(ngModel)]="newEmployee().positionId"
        [disabled]="!newEmployee().departmentId"
      >
        <option [ngValue]="null" disabled>Select Position</option>
        <option *ngFor="let pos of formPositions()" [value]="pos.id">
          {{ pos.title }}
        </option>
      </select>
    </div>
    <div class="button-row">
      <button class="btn btn-success" (click)="addEmployee()" [disabled]="!isFormValid()">
        Add
      </button>
      <button class="btn btn-secondary" (click)="cancelAdd()">Cancel</button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <select class="filter-select" (change)="onDepartmentChange($event.target.value)">
      <option value="">All Departments</option>
      <option *ngFor="let dept of departments()" [value]="dept.id">
        {{ dept.name }}
      </option>
    </select>
    <select class="filter-select" (change)="onPositionChange($event.target.value)">
      <option value="">All Positions</option>
      <option *ngFor="let pos of positions()" [value]="pos.id">
        {{ pos.title }}
      </option>
    </select>
    <input
      type="text"
      class="filter-search"
      placeholder="Search by name..."
      (keyup)="onSearch($event.target.value)"
    />
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading">Loading...</div>

  <!-- Table -->
  <div *ngIf="!isLoading()" class="table-container">
    <div *ngIf="employees().length === 0" class="empty-message">No employees found.</div>

    <table *ngIf="employees().length > 0" class="employees-table">
      <thead>
        <tr>
          <th class="sortable" (click)="toggleSort('firstName')">
            First Name
            <span class="sort-indicator" *ngIf="sortBy() === 'firstName'">
              {{ sortOrder() === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('lastName')">
            Last Name
            <span class="sort-indicator" *ngIf="sortBy() === 'lastName'">
              {{ sortOrder() === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('phoneNumber')">
            Phone Number
            <span class="sort-indicator" *ngIf="sortBy() === 'phoneNumber'">
              {{ sortOrder() === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('department')">
            Department
            <span class="sort-indicator" *ngIf="sortBy() === 'department'">
              {{ sortOrder() === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
          <th class="sortable" (click)="toggleSort('position')">
            Position
            <span class="sort-indicator" *ngIf="sortBy() === 'position'">
              {{ sortOrder() === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let emp of employees()" (click)="openEmployee(emp.id)" class="table-row">
          <td>{{ emp.firstName }}</td>
          <td>{{ emp.lastName }}</td>
          <td>{{ emp.phoneNumber }}</td>
          <td>{{ emp.departmentName }}</td>
          <td>{{ emp.positionName || 'N/A' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="employees().length > 0" class="pagination">
    <button class="btn btn-sm" (click)="changePage(page() - 1)" [disabled]="page() === 1">
      ← Previous
    </button>
    <span class="page-info">
      Page {{ page() }} of {{ Math.ceil(total() / pageSize()) }} (Total: {{ total() }})
    </span>
    <button
      class="btn btn-sm"
      (click)="changePage(page() + 1)"
      [disabled]="page() >= Math.ceil(total() / pageSize())"
    >
      Next →
    </button>
  </div>
</div>
