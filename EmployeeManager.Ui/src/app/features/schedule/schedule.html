<div class="schedule-container">
  <div class="schedule-header">
    <h1>Employee Schedule</h1>
    <div class="controls">
      <label>
        Department:
        <select class="form-control" (change)="onDepartmentChange($event.target.value)">
          <option [value]="''">Select...</option>
          <option *ngFor="let dep of departments()" [value]="dep.id">{{ dep.name }}</option>
        </select>
      </label>
      <label>
        Date:
        <input
          class="form-control"
          type="date"
          [value]="selectedDate()"
          (change)="onDateChange($any($event.target).value)"
        />
      </label>
      <div class="mode-switch">
        <button [class.active]="mode() === 'Daily'" (click)="setMode('Daily')">Daily</button>
        <button [class.active]="mode() === 'Week'" (click)="setMode('Week')">Week</button>
        <button [class.active]="mode() === 'Month'" (click)="setMode('Month')">Month</button>
        <button [class.active]="mode() === 'Year'" (click)="setMode('Year')">Year</button>
      </div>
    </div>
    <div *ngIf="isLoading()" class="loading">Loading schedule data...</div>
    <div *ngIf="errorMessage()" class="error">{{ errorMessage() }}</div>
  </div>

  <div class="schedule-grid">
    <div class="employee-column">
      <div class="employee-header">Employee / Position</div>
      <div class="employee-row" *ngFor="let emp of employees()">
        <div class="employee-cell">
          <div class="emp-name">{{ emp.firstName }} {{ emp.lastName }}</div>
          <div class="emp-position">{{ emp.positionTitle || '—' }}</div>
        </div>
      </div>
    </div>

    <!-- Daily Mode: per selected date -->
    <div class="mode-column" *ngIf="mode() === 'Daily'">
      <div class="mode-header">{{ selectedDate() }}</div>
      <div class="mode-row" *ngFor="let emp of employees()">
        <div class="day-entry">
          <div class="state-select">
            <select
              [value]="getEntry(emp.id, selectedDate()).state"
              (change)="updateState(emp.id, selectedDate(), $any($event.target).value)"
            >
              <option value="OnWork">On Work</option>
              <option value="Rest">Rest</option>
              <option value="Vacation">Vacation</option>
              <option value="Illness">Illness</option>
            </select>
          </div>
          <div class="hours-input">
            <input
              type="number"
              min="0"
              max="24"
              [value]="getEntry(emp.id, selectedDate()).hours"
              (input)="updateHours(emp.id, selectedDate(), +$any($event.target).value)"
            />
            <span class="unit">h</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Week Mode -->
    <div class="mode-column" *ngIf="mode() === 'Week'">
      <div class="mode-header">Week of {{ weekDays()[0] }}</div>
      <div class="week-row header">
        <div class="week-cell" *ngFor="let d of weekDays()">{{ d }}</div>
      </div>
      <div class="mode-row" *ngFor="let emp of employees()">
        <div class="week-row">
          <div class="week-cell" *ngFor="let d of weekDays()">
            <div class="week-entry">
              <div class="state">{{ getEntry(emp.id, d).state }}</div>
              <div class="hours">{{ getEntry(emp.id, d).hours }} h</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Month Mode -->
    <div class="mode-column" *ngIf="mode() === 'Month'">
      <div class="mode-header">Month of {{ selectedDate() | date : 'MMMM yyyy' }}</div>
      <div class="month-row header">
        <div class="month-cell" *ngFor="let d of monthDays()">{{ d.split('-')[2] }}</div>
      </div>
      <div class="mode-row" *ngFor="let emp of employees()">
        <div class="month-row">
          <div class="month-cell" *ngFor="let d of monthDays()">
            <div
              class="month-entry"
              [class.work]="getEntry(emp.id, d).state === 'OnWork'"
              [class.rest]="getEntry(emp.id, d).state !== 'OnWork'"
            >
              {{
                getEntry(emp.id, d).state === 'OnWork'
                  ? getEntry(emp.id, d).hours + 'h'
                  : getEntry(emp.id, d).state
              }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Year Mode -->
    <div class="mode-column" *ngIf="mode() === 'Year'">
      <div class="mode-header">Year {{ selectedDate() | date : 'yyyy' }}</div>
      <div class="year-row header">
        <div class="year-cell" *ngFor="let m of yearMonths()">{{ m | date : 'MMM' }}</div>
      </div>
      <div class="mode-row" *ngFor="let emp of employees()">
        <div class="year-row">
          <div class="year-cell" *ngFor="let m of yearMonths()">
            <!-- Simple placeholder summary: count of work days in month -->
            <div class="year-entry">…</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="note">
    Note: This is a UI scaffold. We can persist schedule to the API once you confirm data model.
  </div>
</div>
