<div class="schedule-page">
  <div class="schedule-page-container">
    <div class="schedule-header">
      <h1>Графік роботи</h1>
    </div>

    <!-- Quick Template Buttons -->
    <div class="quick-templates-panel">
      <div class="quick-templates-controls">
        <label class="quick-fill-toggle">
          <input
            type="checkbox"
            [checked]="isQuickFillMode()"
            (change)="toggleQuickFillMode()" />
          <span>Режим швидкого заповнення</span>
        </label>
        
        <!-- Duration buttons -->
        <div class="template-section">
          <span class="section-label">Тривалість:</span>
          <div class="template-buttons" [class.disabled]="!isQuickFillMode()">
            <button
              type="button"
              class="template-btn"
              [class.active]="selectedTemplate() === 4 && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              (click)="selectTemplate(4)">
              4 год
            </button>
            <button
              type="button"
              class="template-btn"
              [class.active]="selectedTemplate() === 8 && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              (click)="selectTemplate(8)">
              8 год
            </button>
            <button
              type="button"
              class="template-btn"
              [class.active]="selectedTemplate() === 12 && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              (click)="selectTemplate(12)">
              12 год
            </button>
          </div>
        </div>
        
        <!-- State selection -->
        <div class="template-section">
          <span class="section-label">Тип:</span>
          <div class="state-buttons" [class.disabled]="!isQuickFillMode()">
            <button
              type="button"
              class="state-btn"
              [class.active]="selectedTemplateState() === 'OnWork' && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              [style.background-color]="selectedTemplateState() === 'OnWork' && isQuickFillMode() ? '#10b981' : ''"
              (click)="selectTemplateState('OnWork')">
              Робота
            </button>
            <button
              type="button"
              class="state-btn"
              [class.active]="selectedTemplateState() === 'Training' && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              [style.background-color]="selectedTemplateState() === 'Training' && isQuickFillMode() ? '#3b82f6' : ''"
              (click)="selectTemplateState('Training')">
              Навчання
            </button>
            <button
              type="button"
              class="state-btn"
              [class.active]="selectedTemplateState() === 'Vacation' && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              [style.background-color]="selectedTemplateState() === 'Vacation' && isQuickFillMode() ? '#f59e0b' : ''"
              (click)="selectTemplateState('Vacation')">
              Відпустка
            </button>
            <button
              type="button"
              class="state-btn"
              [class.active]="selectedTemplateState() === 'Illness' && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              [style.background-color]="selectedTemplateState() === 'Illness' && isQuickFillMode() ? '#ef4444' : ''"
              (click)="selectTemplateState('Illness')">
              Лікарняний
            </button>
            <button
              type="button"
              class="state-btn"
              [class.active]="selectedTemplateState() === 'Rest' && isQuickFillMode()"
              [disabled]="!isQuickFillMode()"
              [style.background-color]="selectedTemplateState() === 'Rest' && isQuickFillMode() ? '#6b7280' : ''"
              (click)="selectTemplateState('Rest')">
              Вихідний
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters row above calendar -->
    <div class="schedule-filters-row">
      <span class="filters-label">Типи записів:</span>
      <div class="state-filters">
        <label class="state-filter-item">
          <input
            type="checkbox"
            [checked]="filterStates().Training"
            (change)="toggleStateFilter('Training')" />
          <span class="state-color" style="background-color: #3b82f6"></span>
          Навчання
        </label>
        <label class="state-filter-item">
          <input
            type="checkbox"
            [checked]="filterStates().OnWork"
            (change)="toggleStateFilter('OnWork')" />
          <span class="state-color" style="background-color: #10b981"></span>
          Робота
        </label>
        <label class="state-filter-item">
          <input
            type="checkbox"
            [checked]="filterStates().Rest"
            (change)="toggleStateFilter('Rest')" />
          <span class="state-color" style="background-color: #6b7280"></span>
          Вихідний
        </label>
        <label class="state-filter-item">
          <input
            type="checkbox"
            [checked]="filterStates().Vacation"
            (change)="toggleStateFilter('Vacation')" />
          <span class="state-color" style="background-color: #f59e0b"></span>
          Відпустка
        </label>
        <label class="state-filter-item">
          <input
            type="checkbox"
            [checked]="filterStates().Illness"
            (change)="toggleStateFilter('Illness')" />
          <span class="state-color" style="background-color: #ef4444"></span>
          Лікарняний
        </label>
      </div>
    </div>

    <!-- Calendar - shows in both view and build modes -->
    <main class="schedule-main">
      @if (isLoading()) {
        <div class="loading">Завантаження...</div>
      } @else {
        <full-calendar [options]="calendarOptions()"></full-calendar>
      }
    </main>
  </div>

  <!-- Schedule Entry Modal -->
  <app-schedule-entry-modal
    [isOpen]="isModalOpen"
    [entry]="modalEntry()"
    [departments]="departments()"
    [employees]="employees()"
    [selectedEmployeeId]="modalSelectedEmployeeId()"
    [selectedDepartmentId]="modalSelectedDepartmentId()"
    [startTime]="modalStartTime()"
    [endTime]="modalEndTime()"
    (save)="onModalSave($event)"
    (delete)="onModalDelete($event)"
    (close)="closeModal()"
  />
</div>
