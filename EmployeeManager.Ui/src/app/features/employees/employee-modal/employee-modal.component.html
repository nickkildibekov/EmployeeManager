@if (isOpen()) {
<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="stopPropagation($event)">
    <div class="modal-header">
      <h2>{{ isEditMode() ? 'Редагувати співробітника' : 'Додати співробітника' }}</h2>
      <button class="modal-close" (click)="onClose()" aria-label="Close">×</button>
    </div>

    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Ім'я</label>
          <input
            type="text"
            [(ngModel)]="editedEmployee().firstName"
            class="form-input"
            placeholder="Введіть ім'я"
          />
        </div>

        <div class="form-group">
          <label>Прізвище</label>
          <input
            type="text"
            [(ngModel)]="editedEmployee().lastName"
            class="form-input"
            placeholder="Введіть прізвище"
          />
        </div>

        <div class="form-group">
          <label>Позивний <span class="required">*</span></label>
          <input
            type="text"
            [(ngModel)]="editedEmployee().callSign"
            class="form-input"
            placeholder="Введіть позивний"
            required
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Номер телефону <span class="required">*</span></label>
          <input
            type="tel"
            [(ngModel)]="editedEmployee().phoneNumber"
            class="form-input"
            placeholder="Введіть номер телефону"
          />
        </div>

        <div class="form-group">
          <label>День народження</label>
          <div class="date-input-wrapper" (mousedown)="onDateWrapperMouseDown($event, birthDateInput)">
            <input
              type="date"
              [value]="formatDateForInput(editedEmployee().birthDate)"
              (input)="onBirthDateChange($event)"
              class="form-input date-input-native"
              #birthDateInput
            />
            <span
              class="date-input-display"
              [class.placeholder]="!birthDateInput.value"
            >
              {{ birthDateInput.value ? formatDateForDisplay(birthDateInput.value) : 'Оберіть дату' }}
            </span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Відділ</label>
          <select
            [ngModel]="editedEmployee().departmentId"
            (ngModelChange)="onDepartmentChange($event)"
            class="form-input"
          >
            <option [ngValue]="null">Резерв</option>
            @for (dep of filteredDepartments(); track dep.id) {
            <option [ngValue]="dep.id">{{ getDepartmentDisplayName(dep.name) }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label>Посада</label>
          <select [(ngModel)]="editedEmployee().positionId" class="form-input">
            @for (pos of availablePositions(); track pos.id) {
            <option [ngValue]="pos.id">{{ getPositionDisplayName(pos.title) }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label>Спеціальність <span class="required">*</span></label>
          <select [(ngModel)]="editedEmployee().specializationId" class="form-input" required>
            @for (spec of specializations; track spec.id) {
            <option [ngValue]="spec.id">{{ getSpecializationDisplayName(spec.name) }}</option>
            }
          </select>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()">Скасувати</button>
      <button class="btn btn-primary" (click)="onSave()" [disabled]="!isFormValid()">
        {{ isEditMode() ? 'Зберегти' : 'Додати' }}
      </button>
    </div>
  </div>
</div>
}
