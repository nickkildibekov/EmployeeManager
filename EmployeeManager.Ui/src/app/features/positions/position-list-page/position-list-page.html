<div class="container">
  <div class="header">
    <h2>Посади/Спеціальності</h2>
  </div>

  <div *ngIf="error()" class="alert alert-danger">
    {{ error() }}
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button
      class="tab-button"
      [class.active]="activeTab() === 'positions'"
      (click)="setActiveTab('positions')"
    >
      Посади
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab() === 'specializations'"
      (click)="setActiveTab('specializations')"
    >
      Спеціальності
    </button>
  </div>

  <!-- Positions Tab -->
  @if (activeTab() === 'positions') {
  <div class="tab-content">
    <div class="tab-header">
      <button class="btn btn-primary" (click)="openPositionModal()">
        + Додати посаду
      </button>
    </div>

    <!-- Filters -->
    <div class="filters">
      <select class="filter-select" (change)="onDepartmentChange($event.target.value)">
        <option value="">Всі відділи</option>
        <option *ngFor="let dept of departments()" [value]="dept.id">
          {{ dept.name }}
        </option>
      </select>
      <input
        type="text"
        class="filter-search"
        placeholder="Пошук за назвою..."
        (keyup)="onSearch($event.target.value)"
      />
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading">Завантаження...</div>

    <!-- List -->
    <div *ngIf="!isLoading()" class="list-container">
      <div *ngIf="positions().length === 0" class="empty-message">Посад не знайдено.</div>

      <div *ngFor="let pos of positions(); trackBy: trackByPositionId" class="list-item" (click)="openPosition(pos.id)">
        <div class="item-content">
          <h4>{{ getPositionDisplayName(pos.title) }}</h4>
        </div>
        <button
          *ngIf="!isUnemployedPosition(pos.title)"
          class="btn btn-danger btn-sm"
          (click)="deletePosition(pos.id); $event.stopPropagation()"
        >
          Видалити
        </button>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="positions().length > 0" class="pagination">
      <button class="btn btn-sm" (click)="changePage(page() - 1)" [disabled]="page() === 1">
        ← Попередня
      </button>
      <span class="page-info">
        Сторінка {{ page() }} з {{ Math.ceil(total() / pageSize()) }} (Всього: {{ total() }})
      </span>
      <button
        class="btn btn-sm"
        (click)="changePage(page() + 1)"
        [disabled]="page() >= Math.ceil(total() / pageSize())"
      >
        Наступна →
      </button>
    </div>
  </div>
  }

  <!-- Specializations Tab -->
  @if (activeTab() === 'specializations') {
  <div class="tab-content">
    <div class="tab-header">
      <button class="btn btn-primary" (click)="openSpecializationModal()">
        + Додати спеціальність
      </button>
    </div>

    <!-- List -->
    <div class="list-container">
      <div *ngIf="specializations().length === 0" class="empty-message">Спеціальностей не знайдено.</div>

      <div *ngFor="let spec of specializations(); trackBy: trackBySpecializationId" class="list-item">
        <div class="item-content">
          <h4>{{ getSpecializationDisplayName(spec.name) }}</h4>
        </div>
        <button
          *ngIf="!isInternSpecialization(spec.name)"
          class="btn btn-danger btn-sm"
          (click)="deleteSpecialization(spec.id)"
        >
          Видалити
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Position Modal -->
  <app-position-modal
    [isOpen]="isPositionModalOpen"
    [departments]="departments()"
    (save)="onPositionSave($event)"
    (close)="closePositionModal()"
  />

  <!-- Specialization Modal -->
  <app-specialization-modal
    [isOpen]="isSpecializationModalOpen"
    (save)="onSpecializationSave($event)"
    (close)="closeSpecializationModal()"
  />
</div>
